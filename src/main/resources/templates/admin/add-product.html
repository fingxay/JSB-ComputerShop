<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thêm Sản Phẩm Mới - Computer Shop Admin</title>
    <link rel="stylesheet" th:href="@{/CSS/admin.css}">
    <link rel="stylesheet" th:href="@{/CSS/admin-category.css}">
    <link rel="stylesheet" th:href="@{/CSS/admin-product.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        
        <nav class="admin-sidebar">
            <div class="admin-logo">
                <h2><i class="fas fa-laptop"></i> Admin Panel</h2>
            </div>
            <ul class="admin-nav">
                <li><a th:href="@{/admin/dashboard}"><i class="fas fa-chart-bar"></i> Dashboard</a></li>
                <li><a th:href="@{/admin/users}"><i class="fas fa-users"></i> Người Dùng</a></li>
                <li><a th:href="@{/admin/products}" class="active"><i class="fas fa-box"></i> Sản Phẩm</a></li>
                <li><a th:href="@{/admin/categories}"><i class="fas fa-tags"></i> Danh Mục</a></li>
                <li><a th:href="@{/admin/orders}"><i class="fas fa-shopping-cart"></i> Đơn Hàng</a></li>
                <li><a th:href="@{/}"><i class="fas fa-home"></i> Trang Chủ</a></li>
                <li><a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> Đăng Xuất</a></li>
            </ul>
        </nav>

        
        <main class="admin-main">
            <div class="admin-header">
                <h1><i class="fas fa-plus-circle"></i> Thêm Sản Phẩm Mới</h1>
                <div class="admin-breadcrumb">
                    <a th:href="@{/admin/products}"><i class="fas fa-arrow-left"></i> Quay lại danh sách sản phẩm</a>
                </div>
            </div>

            
            <div th:if="${success}" class="admin-alert admin-alert-success">
                <i class="fas fa-check-circle"></i>
                <span th:text="${success}"></span>
            </div>
            <div th:if="${error}" class="admin-alert admin-alert-error">
                <i class="fas fa-exclamation-circle"></i>
                <span th:text="${error}"></span>
            </div>

            
            <div class="admin-form-container">
                <div class="admin-form-header">
                    <h2><i class="fas fa-box"></i> Thông Tin Sản Phẩm</h2>
                    <div class="form-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="formProgress"></div>
                        </div>
                        <span class="progress-text">0% Hoàn thành</span>
                    </div>
                </div>
                
                <form th:action="@{/admin/products/create}" 
                      method="post" 
                      th:object="${newProduct}" 
                      class="admin-form"
                      id="addProductForm">
                    
                    
                    <div class="form-section">
                        <h3><i class="fas fa-info-circle"></i> Thông Tin Cơ Bản</h3>
                        <div class="admin-form-row">
                            <div class="admin-form-group">
                                <label for="productName"><i class="fas fa-box"></i> Tên Sản Phẩm *</label>
                                <input type="text" 
                                       id="productName"
                                       th:field="*{productName}" 
                                       placeholder="Nhập tên sản phẩm..." 
                                       required
                                       oninput="validateForm()">
                                <div class="field-help">Tên sản phẩm phải rõ ràng và dễ hiểu</div>
                            </div>
                            <div class="admin-form-group">
                                <label for="categoryId"><i class="fas fa-tag"></i> Danh Mục *</label>
                                <select id="categoryId" name="categoryId" required onchange="validateForm()">
                                    <option value="">-- Chọn Danh Mục --</option>
                                    <option th:each="category : ${categories}" 
                                            th:value="${category.categoryId}" 
                                            th:text="${category.categoryName}"></option>
                                </select>
                                <div class="field-help">Chọn danh mục phù hợp với sản phẩm</div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="form-section">
                        <h3><i class="fas fa-dollar-sign"></i> Thông Tin Giá Cả</h3>
                        <div class="admin-form-row">
                            <div class="admin-form-group">
                                <label for="price"><i class="fas fa-money-bill-wave"></i> Giá Bán (VND) *</label>
                                <div class="input-with-currency">
                                    <input 
                                           id="price"
                                           th:field="*{price}" 
                                           min="1000"
                                           placeholder="0" 
                                           required
                                           oninput="validateForm(); formatPrice(this)">
                                    <span class="currency-symbol">VND</span>
                                </div>
                                <div class="field-help">Giá tối thiểu: 1,000 VND</div>
                                <div id="pricePreview" class="price-preview"></div>
                            </div>
                            <div class="admin-form-group">
                                <label for="stockQuantity"><i class="fas fa-warehouse"></i> Số Lượng Tồn Kho</label>
                                <input type="number" 
                                       id="stockQuantity"
                                       th:field="*{stockQuantity}" 
                                       min="0"
                                       placeholder="0"
                                       oninput="validateForm(); updateStockStatus(this.value)">
                                <div class="field-help">Để trống nếu chưa có hàng trong kho</div>
                                <div id="stockStatus" class="stock-status"></div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="form-section">
                        <h3><i class="fas fa-align-left"></i> Mô Tả Chi Tiết</h3>
                        <div class="admin-form-group">
                            <label for="description"><i class="fas fa-file-alt"></i> Mô Tả Sản Phẩm</label>
                            <textarea id="description"
                                     th:field="*{description}" 
                                     placeholder="Nhập mô tả chi tiết về sản phẩm..." 
                                     rows="6"
                                     oninput="validateForm(); updateCharCount(this)"></textarea>
                            <div class="char-counter">
                                <span id="charCount">0</span>/1000 ký tự
                            </div>
                            <div class="field-help">Mô tả chi tiết giúp khách hàng hiểu rõ hơn về sản phẩm</div>
                        </div>
                    </div>

                    
                    <div class="form-section">
                        <h3><i class="fas fa-eye"></i> Xem Trước Sản Phẩm</h3>
                        <div class="product-preview" id="productPreview">
                            <div class="preview-card">
                                <div class="preview-header">
                                    <div class="preview-category">Chưa chọn danh mục</div>
                                    <div class="preview-stock">Chưa có thông tin</div>
                                </div>
                                <h4 class="preview-name">Tên sản phẩm sẽ hiển thị ở đây</h4>
                                <div class="preview-price">0 VND</div>
                                <div class="preview-description">Mô tả sản phẩm sẽ hiển thị ở đây</div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="admin-form-actions">
                        <button type="submit" class="admin-btn admin-btn-success" id="submitBtn" disabled>
                            <i class="fas fa-plus"></i> Thêm Sản Phẩm
                        </button>
                        <a th:href="@{/admin/products}" class="admin-btn admin-btn-secondary">
                            <i class="fas fa-times"></i> Hủy Bỏ
                        </a>
                        <button type="reset" class="admin-btn admin-btn-warning" onclick="resetForm()">
                            <i class="fas fa-redo"></i> Làm Mới
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        // Form validation and preview
        function validateForm() {
            const form = document.getElementById('addProductForm');
            const submitBtn = document.getElementById('submitBtn');
            const progressFill = document.getElementById('formProgress');
            const progressText = document.querySelector('.progress-text');
            
            const productName = document.getElementById('productName').value.trim();
            const categoryId = document.getElementById('categoryId').value;
            const price = document.getElementById('price').value;
            
            let progress = 0;
            let isValid = true;
            
            // Check required fields
            if (productName) progress += 33.33;
            else isValid = false;
            
            if (categoryId) progress += 33.33;
            else isValid = false;
            
            if (price && parseFloat(price) >= 1000) progress += 33.34;
            else isValid = false;
            
            // Update progress bar
            progressFill.style.width = progress + '%';
            progressText.textContent = Math.round(progress) + '% Hoàn thành';
            
            // Update submit button
            submitBtn.disabled = !isValid;
            
            // Update preview
            updatePreview();
        }

        function updatePreview() {
            const productName = document.getElementById('productName').value.trim();
            const categorySelect = document.getElementById('categoryId');
            const categoryName = categorySelect.options[categorySelect.selectedIndex]?.text || 'Chưa chọn danh mục';
            const price = document.getElementById('price').value;
            const stock = document.getElementById('stockQuantity').value;
            const description = document.getElementById('description').value.trim();
            
            document.querySelector('.preview-name').textContent = productName || 'Tên sản phẩm sẽ hiển thị ở đây';
            document.querySelector('.preview-category').textContent = categoryName;
            document.querySelector('.preview-price').textContent = price ? formatCurrency(price) + ' VND' : '0 VND';
            document.querySelector('.preview-description').textContent = description || 'Mô tả sản phẩm sẽ hiển thị ở đây';
            
            const stockElement = document.querySelector('.preview-stock');
            if (stock && parseInt(stock) > 0) {
                stockElement.textContent = 'Còn ' + stock + ' sản phẩm';
                stockElement.className = 'preview-stock in-stock';
            } else {
                stockElement.textContent = 'Hết hàng';
                stockElement.className = 'preview-stock out-stock';
            }
        }

        function formatPrice(input) {
            const value = input.value;
            if (value) {
                document.getElementById('pricePreview').textContent = 
                    'Hiển thị: ' + formatCurrency(value) + ' VND';
            } else {
                document.getElementById('pricePreview').textContent = '';
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(amount);
        }

        function updateStockStatus(value) {
            const statusElement = document.getElementById('stockStatus');
            const stock = parseInt(value);
            
            if (isNaN(stock) || stock === 0) {
                statusElement.textContent = 'Trạng thái: Hết hàng';
                statusElement.className = 'stock-status out-of-stock';
            } else if (stock <= 5) {
                statusElement.textContent = 'Trạng thái: Sắp hết hàng';
                statusElement.className = 'stock-status low-stock';
            } else if (stock <= 20) {
                statusElement.textContent = 'Trạng thái: Còn ít hàng';
                statusElement.className = 'stock-status medium-stock';
            } else {
                statusElement.textContent = 'Trạng thái: Còn nhiều hàng';
                statusElement.className = 'stock-status in-stock';
            }
        }

        function updateCharCount(textarea) {
            const count = textarea.value.length;
            document.getElementById('charCount').textContent = count;
            
            const counter = document.querySelector('.char-counter');
            if (count > 1000) {
                counter.style.color = '#e74c3c';
                textarea.value = textarea.value.substring(0, 1000);
                updateCharCount(textarea);
            } else if (count > 800) {
                counter.style.color = '#f39c12';
            } else {
                counter.style.color = '#7f8c8d';
            }
        }

        function resetForm() {
            document.getElementById('addProductForm').reset();
            setTimeout(() => {
                validateForm();
                document.getElementById('pricePreview').textContent = '';
                document.getElementById('stockStatus').textContent = '';
                document.getElementById('charCount').textContent = '0';
                document.querySelector('.char-counter').style.color = '#7f8c8d';
            }, 100);
        }

        // Auto-hide flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            validateForm();
            
            setTimeout(function() {
                const alerts = document.querySelectorAll('.admin-alert');
                alerts.forEach(alert => {
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 300);
                });
            }, 5000);
        });
    </script>

    <style>
        /* Additional styles for add product page */
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .form-section h3 {
            margin: 0 0 1rem 0;
            color: #2c3e50;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 600;
        }

        .input-with-currency {
            position: relative;
        }

        .currency-symbol {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-weight: 600;
            pointer-events: none;
        }

        .field-help {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }

        .price-preview {
            font-size: 0.85rem;
            color: #28a745;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .stock-status {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .stock-status.in-stock { color: #28a745; }
        .stock-status.medium-stock { color: #ffc107; }
        .stock-status.low-stock { color: #fd7e14; }
        .stock-status.out-of-stock { color: #dc3545; }

        .char-counter {
            text-align: right;
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }

        .product-preview {
            padding: 1rem;
            background: white;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .preview-card {
            padding: 1.5rem;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            text-align: center;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .preview-category {
            background: #e9ecef;
            color: #6c757d;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .preview-stock {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .preview-stock.in-stock {
            background: #d4edda;
            color: #155724;
        }

        .preview-stock.out-stock {
            background: #f8d7da;
            color: #721c24;
        }

        .preview-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0 0 0.5rem 0;
        }

        .preview-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #28a745;
            margin: 0 0 1rem 0;
        }

        .preview-description {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .admin-breadcrumb {
            margin-top: 0.5rem;
        }

        .admin-breadcrumb a {
            color: #6c757d;
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .admin-breadcrumb a:hover {
            color: #007bff;
        }
    </style>
</body>
</html>