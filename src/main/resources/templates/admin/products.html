<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω S·∫£n Ph·∫©m - Computer Shop Admin</title>
    <link rel="stylesheet" th:href="@{/CSS/admin.css}">
    <link rel="stylesheet" th:href="@{/CSS/admin-product.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <div class="admin-logo">
                <h2><i class="fas fa-laptop"></i> Admin Panel</h2>
            </div>
            <ul class="admin-nav">
                <li><a th:href="@{/admin/dashboard}"><i class="fas fa-chart-bar"></i> Dashboard</a></li>
                <li><a th:href="@{/admin/users}"><i class="fas fa-users"></i> Ng∆∞·ªùi D√πng</a></li>
                <li><a th:href="@{/admin/products}" class="active"><i class="fas fa-box"></i> S·∫£n Ph·∫©m</a></li>
                <li><a th:href="@{/admin/categories}"><i class="fas fa-tags"></i> Danh M·ª•c</a></li>
                <li><a th:href="@{/admin/orders}"><i class="fas fa-shopping-cart"></i> ƒê∆°n H√†ng</a></li>
                <li><a th:href="@{/}"><i class="fas fa-home"></i> Trang Ch·ªß</a></li>
                <li><a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng Xu·∫•t</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="admin-header">
                <h1><i class="fas fa-box"></i> Qu·∫£n L√Ω S·∫£n Ph·∫©m</h1>
                <p>Qu·∫£n l√Ω th√¥ng tin s·∫£n ph·∫©m v√† kho h√†ng</p>
            </div>

            <!-- Flash Messages -->
            <div th:if="${success}" class="admin-alert admin-alert-success">
                <i class="fas fa-check-circle"></i>
                <span th:text="${success}"></span>
            </div>
            <div th:if="${error}" class="admin-alert admin-alert-error">
                <i class="fas fa-exclamation-circle"></i>
                <span th:text="${error}"></span>
            </div>

            <!-- Quick Actions -->
            <div class="admin-quick-actions">
                <a th:href="@{/admin/products/add}" class="admin-btn admin-btn-primary admin-btn-large">
                    <i class="fas fa-plus-circle"></i> Th√™m S·∫£n Ph·∫©m M·ªõi
                </a>
                <button type="button" class="admin-btn admin-btn-info admin-btn-large" onclick="refreshProducts()">
                    <i class="fas fa-sync-alt"></i> L√†m M·ªõi Danh S√°ch
                </button>
            </div>

            <!-- Products Table -->
            <div class="admin-table-container">
                <div class="admin-table-header">
                    <h2><i class="fas fa-list"></i> Danh S√°ch S·∫£n Ph·∫©m</h2>
                    <div class="admin-table-actions">
                        <span class="admin-summary-count">
                            <i class="fas fa-box"></i>
                            T·ªïng: <strong th:text="${#lists.size(products)}">0</strong> s·∫£n ph·∫©m
                        </span>
                    </div>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag"></i> ID</th>
                            <th><i class="fas fa-box"></i> T√™n S·∫£n Ph·∫©m</th>
                            <th><i class="fas fa-tag"></i> Danh M·ª•c</th>
                            <th><i class="fas fa-dollar-sign"></i> Gi√°</th>
                            <th><i class="fas fa-warehouse"></i> S·ªë L∆∞·ª£ng</th>
                            <th><i class="fas fa-info-circle"></i> Tr·∫°ng Th√°i</th>
                            <th><i class="fas fa-cogs"></i> Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="product : ${products}">
                            <td>
                                <span class="product-id-badge" th:text="${product.productId}"></span>
                            </td>
                            <td>
                                <div class="product-info-with-avatar">
                                    <div class="product-avatar" 
                                         style="background: linear-gradient(135deg, #3b82f6, #06b6d4); 
                                                display: flex; align-items: center; justify-content: center; 
                                                color: white; font-weight: bold; font-size: 1.2rem;">
                                        üñ•Ô∏è
                                    </div>
                                    <div class="product-details">
                                        <div class="product-info">
                                            <strong th:text="${product.productName}"></strong>
                                            <small th:if="${product.description}" 
                                                   class="text-muted" 
                                                   th:text="${#strings.abbreviate(product.description, 50)}"></small>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="admin-badge admin-badge-secondary" 
                                      th:text="${product.category?.categoryName ?: 'N/A'}"></span>
                            </td>
                            <td>
                                <strong th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' VND'"></strong>
                            </td>
                            <td>
                                <span th:classappend="${product.stockQuantity <= 5} ? 'text-danger' : (${product.stockQuantity <= 20} ? 'text-warning' : 'text-success')"
                                      th:text="${product.stockQuantity}"></span>
                            </td>
                            <td>
                                <span th:if="${product.stockQuantity > 20}" class="admin-badge admin-badge-success">
                                    <i class="fas fa-check"></i> C√≤n H√†ng
                                </span>
                                <span th:if="${product.stockQuantity > 0 && product.stockQuantity <= 20}" class="admin-badge admin-badge-warning">
                                    <i class="fas fa-exclamation-triangle"></i> S·∫Øp H·∫øt
                                </span>
                                <span th:if="${product.stockQuantity <= 0}" class="admin-badge admin-badge-danger">
                                    <i class="fas fa-times"></i> H·∫øt H√†ng
                                </span>
                            </td>
                            <td>
                                <div class="admin-actions">
                                    <!-- Edit Button -->
                                    <a th:href="@{/admin/products/{id}/edit(id=${product.productId})}" 
                                       class="admin-btn admin-btn-info">
                                        <i class="fas fa-edit"></i> <span>S·ª≠a</span>
                                    </a>
                                    
                                    <!-- Delete Button -->
                                    <form th:action="@{/admin/products/{id}/delete(id=${product.productId})}" 
                                          method="post" 
                                          style="display: inline-block;">
                                        <button type="submit" 
                                                class="admin-btn admin-btn-danger"
                                                onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')">
                                            <i class="fas fa-trash"></i> <span>X√≥a</span>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(products)}">
                            <td colspan="7" class="text-center text-muted">
                                <i class="fas fa-box-open"></i>
                                <div style="margin-top: 1rem; font-size: 1.2rem; font-weight: 600;">
                                    Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o
                                </div>
                                <div style="margin-top: 0.5rem; color: #94a3b8;">
                                    H√£y th√™m s·∫£n ph·∫©m ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu!
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Statistics -->
            <div class="admin-stats-grid">
                <div class="admin-stat-card">
                    <div class="admin-stat-icon admin-stat-primary">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="admin-stat-content">
                        <h3 th:text="${#lists.size(products)}">0</h3>
                        <p>T·ªïng S·∫£n Ph·∫©m</p>
                    </div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-icon admin-stat-success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="admin-stat-content">
                        <h3 th:text="${#lists.size(#lists.select(products, p -> p.stockQuantity > 0))}">0</h3>
                        <p>C√≤n H√†ng</p>
                    </div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-icon admin-stat-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="admin-stat-content">
                        <h3 th:text="${#lists.size(#lists.select(products, p -> p.stockQuantity <= 5))}">0</h3>
                        <p>S·∫Øp H·∫øt H√†ng</p>
                    </div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-icon admin-stat-warning">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="admin-stat-content">
                        <h3 th:text="${#lists.size(#lists.select(products, p -> p.stockQuantity == 0))}">0</h3>
                        <p>H·∫øt H√†ng</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Auto-hide flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                const alerts = document.querySelectorAll('.admin-alert');
                alerts.forEach(alert => {
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 300);
                });
            }, 5000);
        });

        // Refresh products
        function refreshProducts() {
            location.reload();
        }
    </script>
</body>
</html>